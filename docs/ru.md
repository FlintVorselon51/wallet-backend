# Wallet Backend Project
Добро пожаловать на документацию проекту!
Надеюсь, приведённая здесь информация поможет вам разобраться в проекте.

Для начальной настройки проекта вернитесь к файлу `README.md`.

Итак, в проекте используется Django и Django REST framework.
Если вы использовали эти инструменты, то структура проекта должна быть вам знакома.

`wallet` - это корневая папка проекта Django. В ней находятся следующие приложения:
- `authentication` - приложение, которое предусматривает работу с пользователями.
Логика входа, регистрации, аутентификации и использования токенов находится здесь.
- `core` - приложение, в котором описаны базовые модели проекта, а также их использование.
- `wallet` - автоматически созданное Django приложение.
В нём находятся настройки, общие исключения и urls.

Также в папке проекта можно найти `manage.py` - файл необходимый для управления проектом.

**Любой отправленный на сервер запрос должен содержать заголовок версии API,
иначе сервер вернёт ошибку 412:**

```X-API-VERSION: 0.1.0```

Давайте рассмотрим системы аутентификации и авторизации на проекте.

## Authentication

Система аутентификации довольна проста. В её основе лежат JWT - это специальные токены,
которые выдаются пользователям после успешной аутентификации.

Все endpoint'ы, связанные с аутентификации начинаются с `/api/auth/`

### Login
Уже зарегистрированный пользователь посылает следующий запрос на сервер:

```http request
POST /api/auth/login/

{
  "email": "user@example.com",
  "password": "strong_PASSWORD_1234"
}
```

В случае успешной аутентификации сервер вернёт ответ,
содержимое которого будет выглядеть примерно так:

```json
{
  "accessToken": "<длинная строка, содержащая токен доступа>",
  "refreshToken": "<длинная строка, содержащая рефреш токен>"
}
```

`accessToken` и `refreshToken` представляют собой JWT.
Подробнее о токенах и их содержимом вы можете прочитать [здесь](https://jwt.io).

В последующем, при отправке любого запроса требующего авторизации, пользователь
должен будет включить токен доступа (`accessToken`) в заголовок `Authorization`:

```
Authorization: Bearer <accessToken>
```

### Refresh
Когда время действия токена закончится (его можно узнать дешифровав токен),
пользователь должен отправить запрос на рефреш, чтобы получить новую пару токенов.
Учтите, что рефреш токен тоже имеет ограниченное время действия.

```http request
POST /api/auth/refresh/

{
  "accessToken": "<токен доступа, может быть просрочен>",
  "refreshToken": "<рефреш токен>"
}
```

Сервер возвращает ответ в следующем виде:

```json
{
  "accessToken": "<новый токен доступа>",
  "refreshToken": "<новый рефреш токен>"
}
```

Если действие рефреш токена закончилось, то необходимо пройти повторную аутентификации.

### Registration
Для регистрации в системе следует отправить следующий запрос:
```http request
POST /api/auth/register/

{
  "email": "user@example.com",
  "password": "strong_PASSWORD_1234"
}
```

Успешный ответ:

```json
{
  "detail": "User successfully created."
}
```

### IsEmailAvailableForRegistration
Этот сервис позволяет получить информации о доступности имейла для регистрации:

```http request
POST /api/auth/is-email-available-for-registration/

{
  "email": "user@example.com"
}
```

Успешный ответ:

```json
{
  "email": "user@example.com",
  "available": false
}
```

### SetNewPasswordUsingCurrent
Этот сервис позволяет установить новый пароль.

**Обратите внимание, что этот запрос требует авторизации.**

```http request
POST /api/auth/set-new-password-using-current/

{
  "currentPassword": "strong_PASSWORD_1234",
  "newPassword": "PLEASE_dont_HACK_me_69"
}
```

Успешный ответ:

```json
{
  "detail": "Password successfully changed."
}
```

## Core

В проекте находятся модели, с которыми пользователь может взаимодействовать,
отправляя на сервер HTTP запросы. Эти модели лежат в основе всего проекта.
Для взаимодействия используются такие классические HTTP запросы, как:

- `GET` - для получения сведений о сущности.
- `POST` - для создания сущности.
- `PUT` - для обновления сущности.
- `PATCH` - для частичного обновления сущности.
- `DELETE` - для удаления сущности.

В этом разделе описаны все модели, для чего они нужны,
а также разрешенные с ними действия.

Все endpoint'ы начинаются с `/api/<название модели>/`

### Currency
Модель валюты. Пользователь может только получить сведения о валюте (`GET`).
Он не может создавать новые валюты, удалять или редактировать существующие.
Валюты создаются только администратором напрямую.

Поля модели:
- id (`1`)
- name (`"Russian Ruble"`)
- code (`"RUB"`)
- symbol (`"₽"`)

Endpoints:
```
/api/currencies/
/api/currencies/<currency_id>/
```

### Wallet
Модель кошелька. Кошелёк - это простая модель, у которой есть название, баланс и валюта.
Имя кошелька должно быть уникально для пользователя.

Определенный кошелёк привязан к определённому пользователю. Это означает, что
пользователи не могут производить действия с кошельками, которые им не принадлежат.
Доступны любые HTTP методы.

Поля модели:
- id (`1`)
- creator (`1`) (id пользователя, которому принадлежит кошелёк)
- currency (`1`) (id валюты, к которому привязан кошелёк)
- name (`"Карта сбербанк"`)
- balance (`1488.69`)

Endpoints:
```
/api/wallets/
/api/wallets/<wallet_id>/
```

### TransactionCategory
Модель категории расходов или доходов. 
Принадлежность к одному из этих двух классов определяет значения поля `is_expense`.
Имя категории должно быть уникально для пользователя.

Аналогично кошельку, определенная категория привязана к определенному пользователю.
Доступны любые HTTP методы.

Поля модели:
_- id (`1`)
- creator (`1`) (id пользователя, которому принадлежит категория)
- name (`"Еда"`) 
- is_expense (`true`)

Endpoints:
```
/api/transaction-categories/
/api/transaction-categories/<transaction_category_id>/
```

### Transaction
Модель записи о доходе или расходе. Если транзакция привязана к категории,
то значение поля `is_expense` должно соответствовать значению этого поля у категории.

Транзакция привязана к определенному пользователю.
Доступны любые HTTP методы.

Поля модели:
- id (`1`)
- creator (`1`) (id пользователя, которому принадлежит кошелёк)
- wallet (`1`) (id кошелька, к которому привязана транзакция)
- category (`1`) (id категории, к которому привязана транзакция. Может быть равно `null`)
- executed_at (`"2017-12-11T07:28:30Z"`) (timestamp, когда была совершена транзакция)
- value (`1199.99`)
- title (`"Доставка еды"`)
- description (`""`) (Описание транзакции. Может быть пустым)
- is_expense (`true`)

Endpoints:
```
/api/transactions/
/api/transactions/<transaction_id>/
```
